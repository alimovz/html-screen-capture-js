!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).htmlScreenCaptureJs={})}(this,(function(e){"use strict";var t,o;e.OutputType=void 0,(t=e.OutputType||(e.OutputType={})).OBJECT="object",t.STRING="string",e.LogLevel=void 0,(o=e.LogLevel||(e.LogLevel={})).DEBUG="debug",o.INFO="info",o.WARN="warn",o.ERROR="error",o.FATAL="fatal",o.OFF="off";let n=e.LogLevel.WARN;const r=(t,o)=>{const r=[e.LogLevel.DEBUG,e.LogLevel.INFO,e.LogLevel.WARN,e.LogLevel.ERROR,e.LogLevel.FATAL,e.LogLevel.OFF];r.indexOf(o)>=r.indexOf(n)&&console.log("|html-screen-capture-js|"+o+"| "+t)},s=()=>n===e.LogLevel.DEBUG,l=(t=e.LogLevel.WARN)=>{n=t},a=t=>{r(t,e.LogLevel.DEBUG)},c=t=>{r(t,e.LogLevel.INFO)},i=t=>{r(t,e.LogLevel.WARN)},d=t=>{r(t,e.LogLevel.ERROR)},u=e=>{let t="";const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let n,r,s,l,a,c,i,d=0;for(e=(e=>{const t=e.replace(/\r\n/g,"\n");let o="";for(let e=0;e<t.length;e++){const n=t.charCodeAt(e);n<128?o+=String.fromCharCode(n):n>127&&n<2048?(o+=String.fromCharCode(n>>6|192),o+=String.fromCharCode(63&n|128)):(o+=String.fromCharCode(n>>12|224),o+=String.fromCharCode(n>>6&63|128),o+=String.fromCharCode(63&n|128))}return o})(e);d<e.length;)n=e.charCodeAt(d++),r=e.charCodeAt(d++),s=e.charCodeAt(d++),l=n>>2,a=(3&n)<<4|r>>4,c=(15&r)<<2|s>>6,i=63&s,isNaN(r)?c=i=64:isNaN(s)&&(i=64),t=t+o.charAt(l)+o.charAt(a)+o.charAt(c)+o.charAt(i);return t},g=(e,t,o)=>{(e=>{const t=(e=>{const t=e.className,o="[object SVGAnimatedString]"===t.toString()?t.baseVal:t;return"string"==typeof o?o:""})(e);return(t?t.split(" "):[]).reduce(((e,t)=>(t&&e.push(t),e)),[])})(o).length,o.getAttribute("style")},p=(e,t,o)=>{const n=((e,t)=>{let o="";try{e.canvas||(e.canvas=e.doc.createElement("canvas")),e.canvas.width=t instanceof HTMLImageElement?t.naturalWidth:t.offsetWidth,e.canvas.height=t instanceof HTMLImageElement?t.naturalHeight:t.offsetHeight;const n=e.canvas.getContext("2d");n&&n.drawImage(t,0,0),o=e.canvas.toDataURL(e.options.imageFormatForDataUrl,e.options.imageQualityForDataUrl)}catch(e){i(`getCanvasDataUrl() - ${e.message}`)}return o})(e,t);n&&o.setAttribute("src",n),o.outerHTML=o.outerHTML.replace(/<canvas/g,"<img")},m=(e,t)=>{if(e.ignoredElms.includes(t))return!0;const o=Object.entries(e.options.computedStyleKeyValuePairsOfIgnoredElements);if(e.isBody&&o.length>0){const e=getComputedStyle(t);for(const[t,n]of o)if(e.getPropertyValue(t)===n)return!0}return!1},f=(e,t,o,n)=>{if(e.isBody&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement?((e,t)=>{t.setAttribute("value",e.value);const o=e.getAttribute("type");if(e instanceof HTMLInputElement&&("checkbox"===o||"radio"===o))e.checked?t.setAttribute("checked","checked"):t.removeAttribute("checked");else if(e instanceof HTMLTextAreaElement&&e.value)t.innerText=e.value;else if(e instanceof HTMLSelectElement&&e.value&&e.children)for(let o=e.children.length-1;o>=0;o--)e.children[o].getAttribute("value")===e.value?t.children[o].setAttribute("selected",""):t.children[o].removeAttribute("selected")})(t,o):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement&&p(e,t,o)),n&&(g(0,0,o),e.options.tagsOfSkippedElementsForChildTreeCssHandling.includes(t.tagName.toLowerCase())&&(n=!1)),t.children)for(let r=t.children.length-1;r>=0;r--)m(e,t.children[r])?o.removeChild(o.children[r]):f(e,t.children[r],o.children[r],n)},h=e=>{e.ignoredElms=(e=>{if(!e.options.cssSelectorsOfIgnoredElements||!e.options.cssSelectorsOfIgnoredElements.length)return[];const t=[];return e.options.cssSelectorsOfIgnoredElements.forEach((o=>{e.doc.documentElement.querySelectorAll(o).forEach((e=>{t.push(e)}))})),t})(e);const t=(()=>{const t=e.doc.documentElement.cloneNode(!1);return g(0,e.doc.documentElement,t),t})();return(t=>{const o=e.doc.head.cloneNode(!0);e.isBody=!1,f(e,e.doc.head,o,!1),t.appendChild(o)})(t),(t=>{(e=>{const t=e.doc.createElement("div");t.id="html-screen-capture-dummy-div",t.style.display="none",e.doc.body.appendChild(t);const o=getComputedStyle(t);for(let t=0;t<o.length;t++){const n=o.item(t),r=o.getPropertyValue(n);e.baseClass.set(n,r)}e.baseClass.set("display","block"),t.parentNode&&t.parentNode.removeChild(t)})(e);const o=e.doc.body.cloneNode(!0);e.isBody=!0,f(e,e.doc.body,o,!0),t.appendChild(o)})(t),(()=>{const t=e.doc.createElement("style");let o=`.${e.options.prefixForNewGeneratedClasses}0{`;e.baseClass.forEach(((e,t)=>{o+=`${t}:${e};`})),o+="}",e.classMap.forEach(((e,t)=>{o+=`.${e}{${t}}`})),o+=e.pseudoStyles.join(""),o+=e.options.rulesToAddToDocStyle.join(""),t.appendChild(e.doc.createTextNode(o))})(),t},L=(t,o)=>{let n=null;if(o===e.OutputType.OBJECT)n=t;else{const s=(t?t.outerHTML:"")||"";s&&(o===e.OutputType.STRING?n=s:"uri"===o?n=((r=s)?encodeURI(r):"")||"":"base64"===o&&(n=u(s))),n=n||""}var r;return s()&&a(`output: ${n instanceof HTMLElement?n.outerHTML:n}`),n};e.capture=(t,o,n)=>((t,o,n)=>{const r=(new Date).getTime();let s=null;const a={isBody:!1,baseClass:new Map,classMap:new Map,classCount:0,pseudoStyles:[],pseudoClassCount:0,shouldHandleImgDataUrl:!0,canvas:null,doc:o||document,ignoredElms:[],options:{rulesToAddToDocStyle:[],cssSelectorsOfIgnoredElements:["script","link","style"],computedStyleKeyValuePairsOfIgnoredElements:{display:"none"},tagsOfSkippedElementsForChildTreeCssHandling:["svg"],attrKeyForSavingElementOrigClass:"_class",attrKeyForSavingElementOrigStyle:"_style",prefixForNewGeneratedClasses:"c",prefixForNewGeneratedPseudoClasses:"p",imageFormatForDataUrl:"image/png",imageQualityForDataUrl:.92,logLevel:e.LogLevel.WARN,...n||{}}};try{l(a.options.logLevel);const o=h(a);s=L(o,t||e.OutputType.OBJECT)}catch(e){d(`goCapture() - error - ${e.message}`)}finally{c(`goCapture() - end - ${(new Date).getTime()-r}ms`)}return s})(t,o,n),Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=html-screen-capture.min.js.map
