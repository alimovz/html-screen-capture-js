!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).htmlScreenCaptureJs={})}(this,(function(e){"use strict";var t,o;e.OutputType=void 0,(t=e.OutputType||(e.OutputType={})).OBJECT="object",t.STRING="string",e.LogLevel=void 0,(o=e.LogLevel||(e.LogLevel={})).DEBUG="debug",o.INFO="info",o.WARN="warn",o.ERROR="error",o.FATAL="fatal",o.OFF="off";let n=e.LogLevel.WARN;const s=(t,o)=>{const s=[e.LogLevel.DEBUG,e.LogLevel.INFO,e.LogLevel.WARN,e.LogLevel.ERROR,e.LogLevel.FATAL,e.LogLevel.OFF];s.indexOf(o)>=s.indexOf(n)&&console.log("|html-screen-capture-js|"+o+"| "+t)},l=()=>n===e.LogLevel.DEBUG,r=(t=e.LogLevel.WARN)=>{n=t},a=t=>{s(t,e.LogLevel.DEBUG)},c=t=>{s(t,e.LogLevel.INFO)},i=t=>{s(t,e.LogLevel.WARN)},d=t=>{s(t,e.LogLevel.ERROR)},u=e=>{let t="";const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let n,s,l,r,a,c,i,d=0;for(e=(e=>{const t=e.replace(/\r\n/g,"\n");let o="";for(let e=0;e<t.length;e++){const n=t.charCodeAt(e);n<128?o+=String.fromCharCode(n):n>127&&n<2048?(o+=String.fromCharCode(n>>6|192),o+=String.fromCharCode(63&n|128)):(o+=String.fromCharCode(n>>12|224),o+=String.fromCharCode(n>>6&63|128),o+=String.fromCharCode(63&n|128))}return o})(e);d<e.length;)n=e.charCodeAt(d++),s=e.charCodeAt(d++),l=e.charCodeAt(d++),r=n>>2,a=(3&n)<<4|s>>4,c=(15&s)<<2|l>>6,i=63&l,isNaN(s)?c=i=64:isNaN(l)&&(i=64),t=t+o.charAt(r)+o.charAt(a)+o.charAt(c)+o.charAt(i);return t},p=(e,t,o)=>{(e=>{const t=(e=>{const t=e.className,o="[object SVGAnimatedString]"===t.toString()?t.baseVal:t;return"string"==typeof o?o:""})(e);return(t?t.split(" "):[]).reduce(((e,t)=>(t&&e.push(t),e)),[])})(o).length,o.getAttribute("style");let n=(()=>{let o=`${e.options.prefixForNewGeneratedClasses}0 `;const n=getComputedStyle(t);for(let t=0;t<n.length;t++){const s=n.item(t),l=n.getPropertyValue(s);if(l!==e.baseClass.get(s)){const t=s+":"+l;let n=e.classMap.get(t)||"";n||(e.classCount++,n=`${e.options.prefixForNewGeneratedClasses}${e.classCount}`,e.classMap.set(t,n)),o+=n+" "}}return o})();n+=(()=>{let o="";for(const n of["::before","::after"]){const s=getComputedStyle(t,n);if(!["none","normal"].includes(s.content)){e.pseudoClassCount++;const t=`${e.options.prefixForNewGeneratedPseudoClasses}${e.pseudoClassCount}`;o+=t+" ",e.pseudoStyles.push(`.${t}${n}{`);for(let t=0;t<s.length;t++){const o=s.item(t),n=s.getPropertyValue(o);e.pseudoStyles.push(`${o}:${n};`)}e.pseudoStyles.push("}")}}return o})(),o.setAttribute("class",n.trim())},g=(e,t)=>{let o="";try{e.canvas||(e.canvas=e.doc.createElement("canvas")),e.canvas.width=t instanceof HTMLImageElement?t.naturalWidth:t.offsetWidth,e.canvas.height=t instanceof HTMLImageElement?t.naturalHeight:t.offsetHeight;const n=e.canvas.getContext("2d");n&&n.drawImage(t,0,0),o=e.canvas.toDataURL(e.options.imageFormatForDataUrl,e.options.imageQualityForDataUrl)}catch(e){i(`getCanvasDataUrl() - ${e.message}`)}return o},f=(e,t)=>{if(e.ignoredElms.includes(t))return!0;const o=Object.entries(e.options.computedStyleKeyValuePairsOfIgnoredElements);if(e.isBody&&o.length>0){const e=getComputedStyle(t);for(const[t,n]of o)if(e.getPropertyValue(t)===n)return!0}return!1},m=(e,t,o,n)=>{if(e.isBody&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement?((e,t)=>{t.setAttribute("value",e.value);const o=e.getAttribute("type");if(e instanceof HTMLInputElement&&("checkbox"===o||"radio"===o))e.checked?t.setAttribute("checked","checked"):t.removeAttribute("checked");else if(e instanceof HTMLTextAreaElement&&e.value)t.innerText=e.value;else if(e instanceof HTMLSelectElement&&e.value&&e.children)for(let o=e.children.length-1;o>=0;o--)e.children[o].getAttribute("value")===e.value?t.children[o].setAttribute("selected",""):t.children[o].removeAttribute("selected")})(t,o):t instanceof HTMLImageElement?((e,t,o)=>{if(e.shouldHandleImgDataUrl){const n=g(e,t);n&&o.setAttribute("src",n)}})(e,t,o):t instanceof HTMLCanvasElement&&((e,t,o)=>{const n=g(e,t);n&&o.setAttribute("src",n),o.outerHTML=o.outerHTML.replace(/<canvas/g,"<img")})(e,t,o)),n&&(p(e,t,o),e.options.tagsOfSkippedElementsForChildTreeCssHandling.includes(t.tagName.toLowerCase())&&(n=!1)),t.children)for(let s=t.children.length-1;s>=0;s--)f(e,t.children[s])?o.removeChild(o.children[s]):m(e,t.children[s],o.children[s],n)},h=e=>{e.ignoredElms=(e=>{if(!e.options.cssSelectorsOfIgnoredElements||!e.options.cssSelectorsOfIgnoredElements.length)return[];const t=[];return e.options.cssSelectorsOfIgnoredElements.forEach((o=>{e.doc.documentElement.querySelectorAll(o).forEach((e=>{t.push(e)}))})),t})(e);const t=(()=>{const t=e.doc.documentElement.cloneNode(!1);return p(e,e.doc.documentElement,t),t})();return(t=>{const o=e.doc.head.cloneNode(!0);e.isBody=!1,m(e,e.doc.head,o,!1),t.appendChild(o)})(t),(t=>{(e=>{const t=e.doc.createElement("div");t.id="html-screen-capture-dummy-div",t.style.display="none",e.doc.body.appendChild(t);const o=getComputedStyle(t);for(let t=0;t<o.length;t++){const n=o.item(t),s=o.getPropertyValue(n);e.baseClass.set(n,s)}e.baseClass.set("display","block"),t.parentNode&&t.parentNode.removeChild(t)})(e);const o=e.doc.body.cloneNode(!0);e.isBody=!0,m(e,e.doc.body,o,!0),t.appendChild(o)})(t),(t=>{const o=e.doc.createElement("style");let n=`.${e.options.prefixForNewGeneratedClasses}0{`;e.baseClass.forEach(((e,t)=>{n+=`${t}:${e};`})),n+="}",e.classMap.forEach(((e,t)=>{n+=`.${e}{${t}}`})),n+=e.pseudoStyles.join(""),n+=e.options.rulesToAddToDocStyle.join(""),o.appendChild(e.doc.createTextNode(n))})(),t},C=(t,o)=>{let n=null;if(o===e.OutputType.OBJECT)n=t;else{const l=(t?t.outerHTML:"")||"";l&&(o===e.OutputType.STRING?n=l:"uri"===o?n=((s=l)?encodeURI(s):"")||"":"base64"===o&&(n=u(l))),n=n||""}var s;return l()&&a(`output: ${n instanceof HTMLElement?n.outerHTML:n}`),n};e.capture=(t,o,n)=>((t,o,n)=>{const s=(new Date).getTime();let l=null;const a={isBody:!1,baseClass:new Map,classMap:new Map,classCount:0,pseudoStyles:[],pseudoClassCount:0,shouldHandleImgDataUrl:!0,canvas:null,doc:o||document,ignoredElms:[],options:{rulesToAddToDocStyle:[],cssSelectorsOfIgnoredElements:["script","link","style"],computedStyleKeyValuePairsOfIgnoredElements:{display:"none"},tagsOfSkippedElementsForChildTreeCssHandling:["svg"],attrKeyForSavingElementOrigClass:"_class",attrKeyForSavingElementOrigStyle:"_style",prefixForNewGeneratedClasses:"c",prefixForNewGeneratedPseudoClasses:"p",imageFormatForDataUrl:"image/png",imageQualityForDataUrl:.92,logLevel:e.LogLevel.WARN,...n||{}}};try{r(a.options.logLevel);const o=h(a);l=C(o,t||e.OutputType.OBJECT)}catch(e){d(`goCapture() - error - ${e.message}`)}finally{c(`goCapture() - end - ${(new Date).getTime()-s}ms`)}return l})(t,o,n),Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=html-screen-capture.min.js.map
