{"version":3,"file":"html-screen-capture.esm.js","sources":["../src/types.ts","../src/logger.ts","../src/encoder.ts","../src/capturer.ts","../src/index.ts"],"sourcesContent":["export enum OutputType {\r\n\tOBJECT = 'object',\r\n\tSTRING = 'string',\r\n}\r\nexport enum LogLevel {\r\n\tDEBUG = 'debug',\r\n\tINFO = 'info',\r\n\tWARN = 'warn',\r\n\tERROR = 'error',\r\n\tFATAL = 'fatal',\r\n\tOFF = 'off',\r\n}\r\nexport interface Options {\r\n\trulesToAddToDocStyle?: string[];\r\n\tcssSelectorsOfIgnoredElements: string[];\r\n\ttagsOfSkippedElementsForChildTreeCssHandling?: string[];\r\n\tattrKeyForSavingElementOrigClass?: string;\r\n\tattrKeyForSavingElementOrigStyle?: string;\r\n\tprefixForNewGeneratedClasses?: string;\r\n\tprefixForNewGeneratedPseudoClasses?: string;\r\n\timageFormatForDataUrl?: string;\r\n\timageQualityForDataUrl?: number;\r\n\tlogLevel?: LogLevel;\r\n}\r\nexport type CaptureOutput = HTMLElement | string | null;\r\nexport type CaptureFunction = (outputType?: OutputType, htmlDocument?: HTMLDocument, options?: Options) => CaptureOutput;\r\n","import { LogLevel } from './types';\r\n\r\nlet selectedLogLevel: LogLevel = LogLevel.WARN;\r\n\r\nconst setLogLevel = (levelName: LogLevel = LogLevel.WARN): void => {\r\n\tselectedLogLevel = levelName;\r\n};\r\nconst getLogLevel = (): LogLevel => {\r\n\treturn selectedLogLevel;\r\n};\r\nconst log = (msg: string, levelName: LogLevel): void => {\r\n\tconst logLevelNumbers = [LogLevel.DEBUG, LogLevel.INFO, LogLevel.WARN, LogLevel.ERROR, LogLevel.FATAL, LogLevel.OFF];\r\n\tif (logLevelNumbers.indexOf(levelName) >= logLevelNumbers.indexOf(selectedLogLevel)) {\r\n\t\tconsole.log('|html-screen-capture-js|' + levelName + '| ' + msg);\r\n\t}\r\n};\r\nconst isDebug = (): boolean => {\r\n\treturn selectedLogLevel === LogLevel.DEBUG;\r\n};\r\nconst debug = (msg: string): void => {\r\n\tlog(msg, LogLevel.DEBUG);\r\n};\r\nconst info = (msg: string): void => {\r\n\tlog(msg, LogLevel.INFO);\r\n};\r\nconst warn = (msg: string): void => {\r\n\tlog(msg, LogLevel.WARN);\r\n};\r\nconst error = (msg: string): void => {\r\n\tlog(msg, LogLevel.ERROR);\r\n};\r\nconst fatal = (msg: string): void => {\r\n\tlog(msg, LogLevel.FATAL);\r\n};\r\n\r\nexport const logger = {\r\n\tisDebug,\r\n\tsetLogLevel,\r\n\tgetLogLevel,\r\n\tdebug,\r\n\tinfo,\r\n\twarn,\r\n\terror,\r\n\tfatal,\r\n};\r\n","export const utf8Encode = (str: string): string => {\r\n\tconst target = str.replace(/\\r\\n/g, '\\n');\r\n\tlet utfText = '';\r\n\tfor (let n = 0; n < target.length; n++) {\r\n\t\tconst c = target.charCodeAt(n);\r\n\t\tif (c < 128) {\r\n\t\t\tutfText += String.fromCharCode(c);\r\n\t\t} else if (c > 127 && c < 2048) {\r\n\t\t\tutfText += String.fromCharCode((c >> 6) | 192);\r\n\t\t\tutfText += String.fromCharCode((c & 63) | 128);\r\n\t\t} else {\r\n\t\t\tutfText += String.fromCharCode((c >> 12) | 224);\r\n\t\t\tutfText += String.fromCharCode(((c >> 6) & 63) | 128);\r\n\t\t\tutfText += String.fromCharCode((c & 63) | 128);\r\n\t\t}\r\n\t}\r\n\treturn utfText;\r\n};\r\n\r\nexport const base64Encode = (str: string): string => {\r\n\tlet output = '';\r\n\tconst keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\r\n\tlet chr1, chr2, chr3, enc1, enc2, enc3, enc4;\r\n\tlet i = 0;\r\n\tstr = utf8Encode(str);\r\n\twhile (i < str.length) {\r\n\t\tchr1 = str.charCodeAt(i++);\r\n\t\tchr2 = str.charCodeAt(i++);\r\n\t\tchr3 = str.charCodeAt(i++);\r\n\t\tenc1 = chr1 >> 2;\r\n\t\tenc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n\t\tenc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n\t\tenc4 = chr3 & 63;\r\n\t\tif (isNaN(chr2)) {\r\n\t\t\tenc3 = enc4 = 64;\r\n\t\t} else if (isNaN(chr3)) {\r\n\t\t\tenc4 = 64;\r\n\t\t}\r\n\t\toutput = output + keyStr.charAt(enc1) + keyStr.charAt(enc2) + keyStr.charAt(enc3) + keyStr.charAt(enc4);\r\n\t}\r\n\treturn output;\r\n};\r\n\r\nexport const uriEncode = (str: string): string => {\r\n\treturn (str ? encodeURI(str) : '') || '';\r\n};\r\n","import { CaptureFunction, LogLevel, OutputType } from './types';\r\nimport { logger } from './logger';\r\nimport { base64Encode, uriEncode } from './encoder';\r\n\r\ninterface CaptureContext {\r\n\tisBody: boolean;\r\n\tbaseClass: Map<string, string>;\r\n\tclassMap: Map<string, string>;\r\n\tclassCount: number;\r\n\tpseudoStyles: Array<string>;\r\n\tpseudoClassCount: number;\r\n\tshouldHandleImgDataUrl: boolean;\r\n\tcanvas: HTMLCanvasElement | null;\r\n\tdoc: HTMLDocument;\r\n\tignoredElms: Node[];\r\n\toptions: {\r\n\t\trulesToAddToDocStyle: string[];\r\n\t\tcssSelectorsOfIgnoredElements: string[];\r\n\t\tcomputedStyleKeyValuePairsOfIgnoredElements: object;\r\n\t\ttagsOfSkippedElementsForChildTreeCssHandling: string[];\r\n\t\tattrKeyForSavingElementOrigClass: string;\r\n\t\tattrKeyForSavingElementOrigStyle: string;\r\n\t\tprefixForNewGeneratedClasses: string;\r\n\t\tprefixForNewGeneratedPseudoClasses: string;\r\n\t\timageFormatForDataUrl: string;\r\n\t\timageQualityForDataUrl: number;\r\n\t\tlogLevel: LogLevel;\r\n\t};\r\n}\r\n\r\nconst getClassName = (domElm: Element): string => {\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\tconst className: any = domElm.className;\r\n\tconst stringClass = className.toString() === '[object SVGAnimatedString]' ? className.baseVal : className;\r\n\treturn typeof stringClass === 'string' ? stringClass : '';\r\n};\r\n\r\nconst getClasses = (domElm: Element): string[] => {\r\n\tconst className = getClassName(domElm);\r\n\tconst classNames = className ? className.split(' ') : [];\r\n\treturn classNames.reduce((result: string[], c: string) => {\r\n\t\tif (c) {\r\n\t\t\tresult.push(c);\r\n\t\t}\r\n\t\treturn result;\r\n\t}, [] as string[]);\r\n};\r\n\r\nconst handleElmCss = (context: CaptureContext, domElm: Element, newElm: Element): void => {\r\n\tconst handleOrigClassAndStyle = (): void => {\r\n\t\tif (getClasses(newElm).length > 0) {\r\n\t\t\t//ZUNIT - commented out\r\n\t\t\t//newElm.setAttribute(context.options.attrKeyForSavingElementOrigClass, getClassName(newElm));\r\n\t\t\t//newElm.removeAttribute('class');\r\n\t\t}\r\n\t\tif (newElm.getAttribute('style')) {\r\n\t\t\t//ZUNIT - commented out\r\n\t\t\t// newElm.setAttribute(context.options.attrKeyForSavingElementOrigStyle, newElm.getAttribute('style') || '');\r\n\t\t\t// newElm.removeAttribute('style');\r\n\t\t}\r\n\t};\r\n\t// const handleRegularElmStyle = (): string => {\r\n\t// \tlet classStr = `${context.options.prefixForNewGeneratedClasses}0 `;\r\n\t// \tconst computedStyle = getComputedStyle(domElm);\r\n\t// \tfor (let i = 0; i < computedStyle.length; i++) {\r\n\t// \t\tconst property = computedStyle.item(i);\r\n\t// \t\tconst value = computedStyle.getPropertyValue(property);\r\n\t// \t\tif (value !== context.baseClass.get(property)) {\r\n\t// \t\t\tconst mapKey = property + ':' + value;\r\n\t// \t\t\tlet className: string = context.classMap.get(mapKey) || '';\r\n\t// \t\t\tif (!className) {\r\n\t// \t\t\t\tcontext.classCount++;\r\n\t// \t\t\t\tclassName = `${context.options.prefixForNewGeneratedClasses}${context.classCount}`;\r\n\t// \t\t\t\tcontext.classMap.set(mapKey, className);\r\n\t// \t\t\t}\r\n\t// \t\t\tclassStr += className + ' ';\r\n\t// \t\t}\r\n\t// \t}\r\n\t// \treturn classStr;\r\n\t// };\r\n\t// const handlePseudoElmsStyle = (): string => {\r\n\t// \tlet classStr = '';\r\n\t// \tfor (const pseudoType of ['::before', '::after']) {\r\n\t// \t\tconst computedStyle = getComputedStyle(domElm, pseudoType);\r\n\t// \t\tif (!['none', 'normal'].includes(computedStyle.content)) {\r\n\t// \t\t\tcontext.pseudoClassCount++;\r\n\t// \t\t\tconst className = `${context.options.prefixForNewGeneratedPseudoClasses}${context.pseudoClassCount}`;\r\n\t// \t\t\tclassStr += className + ' ';\r\n\t// \t\t\tcontext.pseudoStyles.push(`.${className}${pseudoType}{`);\r\n\t// \t\t\tfor (let i = 0; i < computedStyle.length; i++) {\r\n\t// \t\t\t\tconst property = computedStyle.item(i);\r\n\t// \t\t\t\tconst value = computedStyle.getPropertyValue(property);\r\n\t// \t\t\t\tcontext.pseudoStyles.push(`${property}:${value};`);\r\n\t// \t\t\t}\r\n\t// \t\t\tcontext.pseudoStyles.push('}');\r\n\t// \t\t}\r\n\t// \t}\r\n\t// \treturn classStr;\r\n\t// };\r\n\thandleOrigClassAndStyle();\r\n\t// let classStr = handleRegularElmStyle();\r\n\t// classStr += handlePseudoElmsStyle();\r\n\t//ZUNIT - commented out\r\n\t//newElm.setAttribute('class', classStr.trim());\r\n};\r\n\r\nconst getCanvasDataUrl = (context: CaptureContext, domElm: HTMLImageElement | HTMLCanvasElement): string => {\r\n\tlet canvasDataUrl = '';\r\n\ttry {\r\n\t\tif (!context.canvas) {\r\n\t\t\tcontext.canvas = context.doc.createElement('canvas');\r\n\t\t}\r\n\t\tcontext.canvas.width = domElm instanceof HTMLImageElement ? domElm.naturalWidth : domElm.offsetWidth;\r\n\t\tcontext.canvas.height = domElm instanceof HTMLImageElement ? domElm.naturalHeight : domElm.offsetHeight;\r\n\t\tconst ctx = context.canvas.getContext('2d');\r\n\t\tif (ctx) {\r\n\t\t\tctx.drawImage(domElm, 0, 0);\r\n\t\t}\r\n\t\tcanvasDataUrl = context.canvas.toDataURL(context.options.imageFormatForDataUrl, context.options.imageQualityForDataUrl);\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\t} catch (ex: any) {\r\n\t\tlogger.warn(`getCanvasDataUrl() - ${ex.message}`);\r\n\t}\r\n\treturn canvasDataUrl;\r\n};\r\n\r\nconst handleInputElement = (domElm: HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement, newElm: Element): void => {\r\n\tnewElm.setAttribute('value', domElm.value);\r\n\tconst domType = domElm.getAttribute('type');\r\n\tif (domElm instanceof HTMLInputElement && (domType === 'checkbox' || domType === 'radio')) {\r\n\t\tif (domElm.checked) {\r\n\t\t\t(newElm as HTMLInputElement).setAttribute('checked', 'checked');\r\n\t\t} else {\r\n\t\t\tnewElm.removeAttribute('checked');\r\n\t\t}\r\n\t} else if (domElm instanceof HTMLTextAreaElement && domElm.value) {\r\n\t\t(newElm as HTMLInputElement).innerText = domElm.value;\r\n\t} else if (domElm instanceof HTMLSelectElement && domElm.value && domElm.children) {\r\n\t\tfor (let i = domElm.children.length - 1; i >= 0; i--) {\r\n\t\t\tif (domElm.children[i].getAttribute('value') === domElm.value) {\r\n\t\t\t\tnewElm.children[i].setAttribute('selected', '');\r\n\t\t\t} else {\r\n\t\t\t\tnewElm.children[i].removeAttribute('selected');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst handleImageElement = (context: CaptureContext, domElm: HTMLImageElement, newElm: Element): void => {\r\n\tif (context.shouldHandleImgDataUrl) {\r\n\t\tconst imgDataUrl = getCanvasDataUrl(context, domElm);\r\n\t\tif (imgDataUrl) {\r\n\t\t\tnewElm.setAttribute('src', imgDataUrl);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst handleCanvasElement = (context: CaptureContext, domElm: HTMLCanvasElement, newElm: Element): void => {\r\n\tconst canvasDataUrl = getCanvasDataUrl(context, domElm);\r\n\tif (canvasDataUrl) {\r\n\t\tnewElm.setAttribute('src', canvasDataUrl);\r\n\t}\r\n\tnewElm.outerHTML = newElm.outerHTML.replace(/<canvas/g, '<img');\r\n};\r\n\r\nconst shouldIgnoreElm = (context: CaptureContext, domElm: Element): boolean => {\r\n\tif (context.ignoredElms.includes(domElm)) {\r\n\t\treturn true;\r\n\t}\r\n\tconst computedStyleKeyValuePairsOfIgnoredElements = Object.entries(context.options.computedStyleKeyValuePairsOfIgnoredElements);\r\n\tif (context.isBody && computedStyleKeyValuePairsOfIgnoredElements.length > 0) {\r\n\t\tconst computedStyle = getComputedStyle(domElm);\r\n\t\tfor (const [k, v] of computedStyleKeyValuePairsOfIgnoredElements) {\r\n\t\t\tif (computedStyle.getPropertyValue(k) === v) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nconst recursiveWalk = (context: CaptureContext, domElm: Element, newElm: Element, handleCss: boolean): void => {\r\n\tif (context.isBody) {\r\n\t\tif (domElm instanceof HTMLInputElement || domElm instanceof HTMLTextAreaElement || domElm instanceof HTMLSelectElement) {\r\n\t\t\thandleInputElement(domElm, newElm);\r\n\t\t} else if (domElm instanceof HTMLImageElement) {\r\n\t\t\thandleImageElement(context, domElm, newElm);\r\n\t\t} else if (domElm instanceof HTMLCanvasElement) {\r\n\t\t\thandleCanvasElement(context, domElm, newElm);\r\n\t\t}\r\n\t}\r\n\tif (handleCss) {\r\n\t\thandleElmCss(context, domElm, newElm);\r\n\t\tif (context.options.tagsOfSkippedElementsForChildTreeCssHandling.includes(domElm.tagName.toLowerCase())) {\r\n\t\t\thandleCss = false;\r\n\t\t}\r\n\t}\r\n\tif (domElm.children) {\r\n\t\tfor (let i = domElm.children.length - 1; i >= 0; i--) {\r\n\t\t\tif (shouldIgnoreElm(context, domElm.children[i])) {\r\n\t\t\t\tnewElm.removeChild(newElm.children[i]);\r\n\t\t\t} else {\r\n\t\t\t\trecursiveWalk(context, domElm.children[i], newElm.children[i], handleCss);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst createBaseClass = (context: CaptureContext) => {\r\n\tconst dummyElm = context.doc.createElement('div');\r\n\tdummyElm.id = 'html-screen-capture-dummy-div';\r\n\tdummyElm.style['display'] = 'none';\r\n\tcontext.doc.body.appendChild(dummyElm);\r\n\tconst computedStyle = getComputedStyle(dummyElm);\r\n\tfor (let i = 0; i < computedStyle.length; i++) {\r\n\t\tconst property = computedStyle.item(i);\r\n\t\tconst value = computedStyle.getPropertyValue(property);\r\n\t\tcontext.baseClass.set(property, value);\r\n\t}\r\n\tcontext.baseClass.set('display', 'block');\r\n\tif (dummyElm.parentNode) {\r\n\t\tdummyElm.parentNode.removeChild(dummyElm);\r\n\t}\r\n};\r\n\r\nconst getIgnoredElms = (context: CaptureContext) => {\r\n\tif (!context.options.cssSelectorsOfIgnoredElements || !context.options.cssSelectorsOfIgnoredElements.length) {\r\n\t\treturn [];\r\n\t}\r\n\tconst ignoredElms: Node[] = [];\r\n\tcontext.options.cssSelectorsOfIgnoredElements.forEach(cssSelector => {\r\n\t\tconst elms = context.doc.documentElement.querySelectorAll(cssSelector);\r\n\t\telms.forEach(elm => {\r\n\t\t\tignoredElms.push(elm);\r\n\t\t});\r\n\t});\r\n\treturn ignoredElms;\r\n};\r\n\r\nconst getHtmlObject = (context: CaptureContext): HTMLElement => {\r\n\tcontext.ignoredElms = getIgnoredElms(context);\r\n\tconst createNewHtml = (): HTMLElement => {\r\n\t\tconst newHtml = context.doc.documentElement.cloneNode(false) as HTMLElement;\r\n\t\thandleElmCss(context, context.doc.documentElement, newHtml);\r\n\t\treturn newHtml;\r\n\t};\r\n\tconst appendNewHead = (newHtml: HTMLElement): void => {\r\n\t\tconst newHead = context.doc.head.cloneNode(true) as HTMLElement;\r\n\t\tcontext.isBody = false;\r\n\t\trecursiveWalk(context, context.doc.head, newHead, false);\r\n\t\tnewHtml.appendChild(newHead);\r\n\t};\r\n\tconst appendNewBody = (newHtml: HTMLElement): void => {\r\n\t\tcreateBaseClass(context);\r\n\t\tconst newBody = context.doc.body.cloneNode(true) as HTMLElement;\r\n\t\tcontext.isBody = true;\r\n\t\trecursiveWalk(context, context.doc.body, newBody, true);\r\n\t\tnewHtml.appendChild(newBody);\r\n\t};\r\n\tconst appendNewStyle = (): void => {\r\n\t\tconst style = context.doc.createElement('style');\r\n\t\tlet cssText = `.${context.options.prefixForNewGeneratedClasses}0{`;\r\n\t\tcontext.baseClass.forEach((v, k) => {\r\n\t\t\tcssText += `${k}:${v};`;\r\n\t\t});\r\n\t\tcssText += '}';\r\n\t\tcontext.classMap.forEach((v, k) => {\r\n\t\t\tcssText += `.${v}{${k}}`;\r\n\t\t});\r\n\t\tcssText += context.pseudoStyles.join('');\r\n\t\tcssText += context.options.rulesToAddToDocStyle.join('');\r\n\t\tstyle.appendChild(context.doc.createTextNode(cssText));\r\n\t\t//ZUNIT - commented this out\r\n\t\t//newHtml.children[0].appendChild(style);\r\n\t};\r\n\tconst newHtml = createNewHtml();\r\n\tappendNewHead(newHtml);\r\n\tappendNewBody(newHtml);\r\n\tappendNewStyle();\r\n\treturn newHtml;\r\n};\r\n\r\nconst prepareOutput = (newHtmlObject: HTMLElement, outputType: OutputType): string | HTMLElement => {\r\n\tlet output: string | HTMLElement | null = null;\r\n\tif (outputType === OutputType.OBJECT) {\r\n\t\toutput = newHtmlObject;\r\n\t} else {\r\n\t\tconst outerHtml = (newHtmlObject ? newHtmlObject.outerHTML : '') || '';\r\n\t\tif (outerHtml) {\r\n\t\t\tif (outputType === OutputType.STRING) {\r\n\t\t\t\toutput = outerHtml;\r\n\t\t\t} else if (outputType === 'uri') {\r\n\t\t\t\t//support for a deprecated value\r\n\t\t\t\toutput = uriEncode(outerHtml);\r\n\t\t\t} else if (outputType === 'base64') {\r\n\t\t\t\t//support for a deprecated value\r\n\t\t\t\toutput = base64Encode(outerHtml);\r\n\t\t\t}\r\n\t\t}\r\n\t\toutput = output || '';\r\n\t}\r\n\tif (logger.isDebug()) {\r\n\t\tlogger.debug(`output: ${output instanceof HTMLElement ? output.outerHTML : output}`);\r\n\t}\r\n\treturn output;\r\n};\r\n\r\nexport const goCapture: CaptureFunction = (outputType?, htmlDocument?, options?) => {\r\n\tconst startTime = new Date().getTime();\r\n\tlet output: string | HTMLElement | null = null;\r\n\tconst context: CaptureContext = {\r\n\t\tisBody: false,\r\n\t\tbaseClass: new Map<string, string>(),\r\n\t\tclassMap: new Map<string, string>(),\r\n\t\tclassCount: 0,\r\n\t\tpseudoStyles: [],\r\n\t\tpseudoClassCount: 0,\r\n\t\tshouldHandleImgDataUrl: true,\r\n\t\tcanvas: null,\r\n\t\tdoc: htmlDocument || document,\r\n\t\tignoredElms: [],\r\n\t\toptions: {\r\n\t\t\t...{\r\n\t\t\t\trulesToAddToDocStyle: [],\r\n\t\t\t\tcssSelectorsOfIgnoredElements: ['script', 'link', 'style'],\r\n\t\t\t\tcomputedStyleKeyValuePairsOfIgnoredElements: { display: 'none' },\r\n\t\t\t\ttagsOfSkippedElementsForChildTreeCssHandling: ['svg'],\r\n\t\t\t\tattrKeyForSavingElementOrigClass: '_class',\r\n\t\t\t\tattrKeyForSavingElementOrigStyle: '_style',\r\n\t\t\t\tprefixForNewGeneratedClasses: 'c',\r\n\t\t\t\tprefixForNewGeneratedPseudoClasses: 'p',\r\n\t\t\t\timageFormatForDataUrl: 'image/png',\r\n\t\t\t\timageQualityForDataUrl: 0.92,\r\n\t\t\t\tlogLevel: LogLevel.WARN,\r\n\t\t\t},\r\n\t\t\t...(options || {}),\r\n\t\t},\r\n\t};\r\n\ttry {\r\n\t\tlogger.setLogLevel(context.options.logLevel);\r\n\t\tconst newHtmlObject = getHtmlObject(context);\r\n\t\toutput = prepareOutput(newHtmlObject, outputType || OutputType.OBJECT);\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\t} catch (ex: any) {\r\n\t\tlogger.error(`goCapture() - error - ${ex.message}`);\r\n\t} finally {\r\n\t\tlogger.info(`goCapture() - end - ${new Date().getTime() - startTime}ms`);\r\n\t}\r\n\treturn output;\r\n};\r\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { OutputType, LogLevel, Options, CaptureOutput, CaptureFunction } from './types';\r\nimport { goCapture } from './capturer';\r\n\r\nexport { OutputType, LogLevel, Options, CaptureOutput, CaptureFunction } from './types';\r\nexport const capture: CaptureFunction = (outputType?, htmlDocument?, options?) => {\r\n\treturn goCapture(outputType, htmlDocument, options);\r\n};\r\n"],"names":["OutputType","LogLevel","selectedLogLevel","WARN","log","msg","levelName","logLevelNumbers","DEBUG","INFO","ERROR","FATAL","OFF","indexOf","console","logger","base64Encode","str","output","keyStr","chr1","chr2","chr3","enc1","enc2","enc3","enc4","i","target","replace","utfText","n","length","c","charCodeAt","String","fromCharCode","utf8Encode","isNaN","charAt","handleElmCss","context","domElm","newElm","className","stringClass","toString","baseVal","getClassName","split","reduce","result","push","getClasses","getAttribute","getCanvasDataUrl","canvasDataUrl","canvas","doc","createElement","width","HTMLImageElement","naturalWidth","offsetWidth","height","naturalHeight","offsetHeight","ctx","getContext","drawImage","toDataURL","options","imageFormatForDataUrl","imageQualityForDataUrl","ex","message","shouldIgnoreElm","ignoredElms","includes","computedStyleKeyValuePairsOfIgnoredElements","Object","entries","isBody","computedStyle","getComputedStyle","k","v","getPropertyValue","recursiveWalk","handleCss","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","setAttribute","value","domType","checked","removeAttribute","innerText","children","handleInputElement","shouldHandleImgDataUrl","imgDataUrl","handleImageElement","HTMLCanvasElement","outerHTML","handleCanvasElement","tagsOfSkippedElementsForChildTreeCssHandling","tagName","toLowerCase","removeChild","getHtmlObject","cssSelectorsOfIgnoredElements","forEach","cssSelector","documentElement","querySelectorAll","elm","getIgnoredElms","newHtml","cloneNode","createNewHtml","newHead","head","appendChild","appendNewHead","dummyElm","id","style","body","property","item","baseClass","set","parentNode","createBaseClass","newBody","appendNewBody","cssText","prefixForNewGeneratedClasses","classMap","pseudoStyles","join","rulesToAddToDocStyle","createTextNode","appendNewStyle","prepareOutput","newHtmlObject","outputType","OBJECT","outerHtml","STRING","encodeURI","HTMLElement","capture","htmlDocument","startTime","Date","getTime","Map","classCount","pseudoClassCount","document","display","attrKeyForSavingElementOrigClass","attrKeyForSavingElementOrigStyle","prefixForNewGeneratedPseudoClasses","logLevel","goCapture"],"mappings":"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"}